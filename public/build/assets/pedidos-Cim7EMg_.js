document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Pedidos cargado");const a=document.getElementById("dialog-completar"),s=document.getElementById("dialog-cancelar"),i=document.getElementById("dialog-error"),u=document.getElementById("btn-cerrar-completar"),m=document.getElementById("btn-cerrar-cancelar"),p=document.getElementById("btn-cerrar-error"),o=document.getElementById("btn-confirmar-completar"),c=document.getElementById("btn-confirmar-cancelar"),C=document.getElementById("mensaje-error");let r,n;function l(e){C.textContent=e,i.showModal()}document.querySelectorAll(".btn-completar").forEach(e=>{e.addEventListener("click",function(t){t.preventDefault(),r=this.getAttribute("data-id"),n=this.closest("tr"),a.showModal()})}),o.addEventListener("click",function(){o.disabled=!0,o.textContent="Procesando...",fetch(`/pedidos/${r}/complete`,{method:"PATCH",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(e.success){const t=n.querySelector(".status-cell");t.textContent="Completado";const d=n.querySelector("td:last-child");d.innerHTML="",a.close()}else l(e.error||"No se pudo completar el pedido.")}).catch(e=>{console.error("Error:",e),l("Hubo un problema: "+e.message)}).finally(()=>{o.disabled=!1,o.textContent="Sí"})}),u.addEventListener("click",function(){a.close()}),document.querySelectorAll(".btn-cancelar").forEach(e=>{e.addEventListener("click",function(t){t.preventDefault(),r=this.getAttribute("data-id"),n=this.closest("tr"),s.showModal()})}),c.addEventListener("click",function(){c.disabled=!0,c.textContent="Procesando...",fetch(`/pedidos/${r}/cancel`,{method:"PATCH",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(e.success){const t=n.querySelector(".status-cell");t.textContent="Cancelado";const d=n.querySelector("td:last-child");d.innerHTML="",s.close()}else l(e.error||"No se pudo cancelar el pedido.")}).catch(e=>{console.error("Error:",e),l("Hubo un problema: "+e.message)}).finally(()=>{c.disabled=!1,c.textContent="Sí"})}),m.addEventListener("click",function(){s.close()}),p.addEventListener("click",function(){i.close()})});
