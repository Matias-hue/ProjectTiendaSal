import{a as $}from"./index-DtQ_HIrt.js";window.axios=$;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Inventario cargado");const d=document.getElementById("btn-agregar"),n=document.getElementById("dialog-agregar"),a=document.getElementById("btn-cerrar");if(d&&n&&a){d.addEventListener("click",()=>n.showModal()),a.addEventListener("click",()=>n.close());const r=n.querySelector("form"),u=r==null?void 0:r.querySelector('button[type="submit"]');r==null||r.addEventListener("submit",()=>{u&&(u.disabled=!0,u.innerText="Creando...")})}const l=document.getElementById("dialog-editar"),f=document.getElementById("btn-cerrar-editar"),g=document.getElementById("form-editar");if(l&&g){document.querySelectorAll(".btn-editar-tabla").forEach(u=>{u.addEventListener("click",()=>{const i=u.dataset.id;document.getElementById("edit-nombre").value=u.dataset.nombre,document.getElementById("edit-tamaño").value=u.dataset.tamaño,document.getElementById("edit-precio").value=u.dataset.precio,document.getElementById("edit-stock").value=u.dataset.stock,g.action=`/productos/${i}`,l.showModal()})});const r=g.querySelector('button[type="submit"]');g.addEventListener("submit",()=>{r&&(r.disabled=!0,r.innerText="Editando...")}),f==null||f.addEventListener("click",()=>l.close())}const b=document.getElementById("dialog-eliminar"),s=document.getElementById("btn-cerrar-eliminar"),o=document.getElementById("btn-confirmar-eliminar");let E;b&&o&&(document.querySelectorAll(".btn-eliminar-tabla").forEach(r=>{r.addEventListener("click",()=>{E=r.dataset.id;const u=r.dataset.nombre||"producto",i=document.getElementById("mensaje-eliminar");i&&(i.innerText=`¿Estás seguro de que deseas eliminar el producto "${u}"?`),b.showModal()})}),o.addEventListener("click",()=>{var u;o.disabled=!0,o.innerText="Eliminando...";const r=(u=document.querySelector('meta[name="csrf-token"]'))==null?void 0:u.getAttribute("content");fetch(`/productos/${E}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":r||"",Accept:"application/json"}}).then(i=>{i.ok?location.reload():(console.error("Error al eliminar:",i),alert("Error al eliminar el producto."))}).catch(i=>{console.error("Error:",i),alert("Hubo un problema al eliminar el producto: "+i.message)})}),s==null||s.addEventListener("click",()=>b.close()))});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Pedidos cargado");const d=document.getElementById("dialog-completar"),n=document.getElementById("dialog-cancelar"),a=document.getElementById("dialog-error"),l=document.getElementById("dialog-success");document.getElementById("detailsModal");const f=document.getElementById("btn-cerrar-completar"),g=document.getElementById("btn-cerrar-cancelar"),b=document.getElementById("btn-cerrar-error"),s=document.getElementById("btn-cerrar-success"),o=document.getElementById("btn-confirmar-completar"),E=document.getElementById("btn-confirmar-cancelar"),r=document.getElementById("mensaje-error"),u=document.getElementById("mensaje-success"),i=document.getElementById("user_search"),v=document.getElementById("user_id"),m=document.getElementById("user-suggestions");let L,p;function C(e){r&&a&&(r.textContent=e,a.showModal())}function S(e){u&&l&&(u.textContent=e,l.showModal())}if(i&&m){let e=null;i.addEventListener("input",function(){clearTimeout(e),e=setTimeout(()=>{const c=i.value.trim();if(c.length<2){m.innerHTML="",m.style.display="none";return}fetch(`/usuarios?search=${encodeURIComponent(c)}`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(t=>{if(!t.ok)throw new Error(`Error HTTP: ${t.status}`);return t.json()}).then(t=>{if(m.innerHTML="",t.data.length===0){m.innerHTML='<div class="suggestion-item">No se encontraron usuarios</div>',m.style.display="block";return}t.data.forEach(y=>{const k=document.createElement("div");k.className="suggestion-item",k.textContent=`${y.name||"No disponible"} (${y.email})`,k.dataset.userId=y.id,k.addEventListener("click",()=>{i.value=`${y.name||"No disponible"} (${y.email})`,v.value=y.id,m.innerHTML="",m.style.display="none"}),m.appendChild(k)}),m.style.display="block"}).catch(t=>{console.error("Error fetching users:",t),m.innerHTML='<div class="suggestion-item">Error al buscar usuarios</div>',m.style.display="block"})},300)}),document.addEventListener("click",function(c){!i.contains(c.target)&&!m.contains(c.target)&&(m.innerHTML="",m.style.display="none")})}document.querySelectorAll(".btn-completar").forEach(e=>{e.addEventListener("click",function(c){c.preventDefault(),L=this.getAttribute("data-id"),p=this.closest("tr"),d&&d.showModal()})}),document.querySelectorAll(".btn-cancelar").forEach(e=>{e.addEventListener("click",function(c){c.preventDefault(),L=this.getAttribute("data-id"),p=this.closest("tr"),n&&n.showModal()})}),document.querySelectorAll(".btn-detalles").forEach(e=>{e.addEventListener("click",function(c){c.preventDefault();const t=this.getAttribute("data-id");t?H(t):C("ID del pedido no encontrado.")})});const q=document.querySelector(".btn-crear-pedido");q&&q.addEventListener("click",function(e){e.preventDefault(),window.location.href="/pedidos/create"}),document.querySelectorAll("#create-order-form, #edit-order-form").forEach(e=>{e.addEventListener("submit",function(c){var k;c.preventDefault();const t=e.querySelector('button[type="submit"]');if(t&&(t.disabled=!0,t.textContent=e.id==="create-order-form"?"Creando pedido...":"Guardando cambios..."),!v.value){C("Por favor, selecciona un usuario."),t&&(t.disabled=!1,t.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios");return}const y=Array.from(e.querySelectorAll(".item-quantity")).map((h,x)=>{const w=e.querySelectorAll(".item-product")[x],M=parseInt(w.selectedOptions[0].dataset.stock),A=parseInt(h.value);return A>M?(C(`La cantidad para ${w.selectedOptions[0].text} excede el stock disponible (${M}).`),null):{product_id:w.value,quantity:A}});if(y.includes(null)){t&&(t.disabled=!1,t.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios");return}fetch(e.action,{method:((k=e.querySelector('input[name="_method"]'))==null?void 0:k.value)||e.method,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({user_id:e.querySelector("#user_id").value,items:y})}).then(h=>h.ok?h.json():h.text().then(x=>{throw new Error(`Error HTTP: ${h.status} - ${x}`)})).then(h=>{h.success?(S(h.success),setTimeout(()=>window.location.href="/pedidos",1e3)):(C(h.error||"No se pudo procesar el pedido."),t&&(t.disabled=!1,t.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios"))}).catch(h=>{console.error("Error:",h),C("Hubo un problema: "+h.message),t&&(t.disabled=!1,t.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios")})})});const T=document.getElementById("add-item");T&&T.addEventListener("click",function(){const e=document.querySelector("#items-table tbody"),c=e.children.length,t=document.createElement("tr");t.innerHTML=`
                <td>
                    <select name="items[${c}][product_id]" class="item-product">
                        ${Array.from(document.querySelector(".item-product").options).map(y=>`<option value="${y.value}" data-stock="${y.dataset.stock}">${y.text}</option>`).join("")}
                    </select>
                </td>
                <td>
                    <input type="number" name="items[${c}][quantity]" value="1" min="1" class="item-quantity">
                </td>
                <td>
                    <button type="button" class="btn-remove-item">Eliminar</button>
                </td>
            `,e.appendChild(t)}),document.addEventListener("click",function(e){e.target.classList.contains("btn-remove-item")&&document.querySelectorAll("#items-table tbody tr").length>1&&e.target.closest("tr").remove()}),o&&o.addEventListener("click",function(){o.disabled=!0,o.textContent="Procesando...",fetch(`/pedidos/${L}/complete`,{method:"PATCH",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.ok?e.json():e.text().then(c=>{throw new Error(`Error HTTP: ${e.status} - ${c}`)})).then(e=>{if(e.success){const c=p==null?void 0:p.querySelector(".status-cell"),t=p==null?void 0:p.querySelector("td:last-child");c&&(c.textContent="Completado"),t&&(t.innerHTML=`<button class="btn-detalles" data-id="${L}" aria-label="Ver detalles del pedido #${L}">Ver Detalles</button>`),d&&d.close(),S(e.success)}else C(e.error||"No se pudo completar el pedido.")}).catch(e=>{console.error("Error:",e),C("Hubo un problema: "+e.message)}).finally(()=>{o&&(o.disabled=!1,o.textContent="Sí")})}),E&&E.addEventListener("click",function(){E.disabled=!0,E.textContent="Procesando...",fetch(`/pedidos/${L}/cancel`,{method:"PATCH",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.ok?e.json():e.text().then(c=>{throw new Error(`Error HTTP: ${e.status} - ${c}`)})).then(e=>{if(e.success){const c=p==null?void 0:p.querySelector(".status-cell"),t=p==null?void 0:p.querySelector("td:last-child");c&&(c.textContent="Cancelado"),t&&(t.innerHTML=`<button class="btn-detalles" data-id="${L}" aria-label="Ver detalles del pedido #${L}">Ver Detalles</button>`),n&&n.close(),S(e.success)}else C(e.error||"No se pudo cancelar el pedido.")}).catch(e=>{console.error("Error:",e),C("Hubo un problema al cancelar el pedido: "+e.message)}).finally(()=>{E&&(E.disabled=!1,E.textContent="Sí")})}),f&&d&&f.addEventListener("click",()=>d.close()),g&&n&&g.addEventListener("click",()=>n.close()),b&&a&&b.addEventListener("click",()=>a.close()),s&&l&&s.addEventListener("click",()=>l.close())});function H(d){fetch(`/pedidos/${d}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"text/html"}}).then(n=>{if(!n.ok)throw new Error("Error HTTP: "+n.status);return n.text()}).then(n=>{document.getElementById("detailsContent").innerHTML=n,document.getElementById("pdfLink").href=`/pedidos/${d}/pdf`;const a=document.getElementById("detailsModal");a&&a.showModal()}).catch(n=>{console.error("Error al cargar detalles:",n);const a=document.getElementById("mensaje-error"),l=document.getElementById("dialog-error");a&&l&&(a.textContent="Error al cargar los detalles del pedido: "+n.message,l.showModal())})}document.addEventListener("DOMContentLoaded",function(){document.getElementById("search-registro").addEventListener("keypress",function(n){if(n.key==="Enter"){const a=n.target.value;window.location.href="/registro?search="+encodeURIComponent(a)}})});document.addEventListener("DOMContentLoaded",function(){const d=document.getElementById("ventasPorDiaChart").getContext("2d");new Chart(d,{type:"bar",data:{labels:window.chartLabels,datasets:[{label:"Productos Vendidos",data:window.chartData,backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},options:{scales:{y:{beginAtZero:!0,title:{display:!0,text:"Cantidad Vendida"}},x:{title:{display:!0,text:"Día del Mes"}}}}});const n=document.getElementById("productoMasVendidoChart").getContext("2d");new Chart(n,{type:"doughnut",data:{labels:[window.productoMasVendido?window.productoMasVendido.nombre:"Sin datos","Otros"],datasets:[{data:[window.productoMasVendido?window.productoMasVendido.total_vendido:0,1],backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(200, 200, 200, 0.3)"],borderColor:["rgba(255, 99, 132, 1)","rgba(200, 200, 200, 1)"],borderWidth:1}]},options:{plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(l){return l.label+": "+l.raw+" unidades"}}}}}});const a=document.getElementById("todosProductosChart").getContext("2d");new Chart(a,{type:"bar",data:{labels:window.productosLabels,datasets:[{label:"Cantidad Vendida",data:window.productosData,backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},options:{scales:{y:{beginAtZero:!0,title:{display:!0,text:"Cantidad Vendida"}},x:{title:{display:!0,text:"Producto"}}},plugins:{legend:{display:!1}}}})});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Ubicación cargado")});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Usuarios cargado");const d=document.getElementById("search"),n=document.getElementById("usuarios-table-body"),a=document.querySelector(".pagination"),l="/usuarios",f=d==null?void 0:d.form;let g=null;d&&d.addEventListener("input",function(){clearTimeout(g),g=setTimeout(()=>{const s=d.value.trim();b(s)},300)}),f&&f.addEventListener("submit",function(s){s.preventDefault();const o=d.value.trim();b(o)}),a&&a.addEventListener("click",function(s){s.preventDefault();const o=s.target.closest(".page-link");if(o&&!o.parentElement.classList.contains("disabled")){const E=o.getAttribute("href");b(null,E)}});function b(s="",o=null){const E=o||`${l}?search=${encodeURIComponent(s)}`;fetch(E,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(r=>{if(!r.ok)throw new Error(`Error HTTP: ${r.status}`);return r.json()}).then(r=>{if(n.innerHTML="",r.data.length===0){n.innerHTML='<tr><td colspan="6" style="text-align:center;">No se encontraron usuarios</td></tr>';return}r.data.forEach(i=>{const v=document.createElement("tr"),m=document.createElement("td");m.textContent=i.id,v.appendChild(m);const L=document.createElement("td");L.textContent=i.name||"No disponible",v.appendChild(L);const p=document.createElement("td");p.textContent=i.email||"No disponible",v.appendChild(p);const C=document.createElement("td");C.textContent=i.phone||"No disponible",v.appendChild(C);const S=document.createElement("td");S.textContent=i.address||"No disponible",v.appendChild(S);const I=document.createElement("td");I.textContent=i.role||"Usuario",v.appendChild(I);const B=document.createElement("td");B.innerHTML=`<a href="/usuarios/${i.id}/edit" class="btn-editar" aria-label="Editar usuario ${i.name||"No disponible"}">Editar</a>`,v.appendChild(B),n.appendChild(v)}),a.innerHTML=r.links||"";const u=s?`${l}?search=${encodeURIComponent(s)}`:l;window.history.pushState({},"",u)}).catch(r=>{console.error("Error fetching users:",r),n.innerHTML='<tr><td colspan="6" style="text-align:center;">Error al cargar usuarios</td></tr>'})}});document.addEventListener("DOMContentLoaded",()=>{const d=document.querySelector(".dashboard-sidebar"),n=document.querySelector(".navbar-toggler"),a=document.querySelector(".dashboard-container");if(!d||!n||!a){console.error("Uno o más elementos no se encontraron:",{sidebar:d,toggler:n,dashboardContainer:a});return}const l=()=>{const s=d.classList.toggle("active");a.style.display=s?"block":"none",localStorage.setItem("dashboardState",s?"visible":"hidden")};n.addEventListener("click",l),d.classList.add("active"),a.style.display="block";const f=document.querySelector("#inventario-badge"),g=document.querySelector("#pedidos-badge"),b=document.querySelector("#alertas-badge");if(f&&g&&b){const s=()=>{fetch("/alertas/total",{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(o=>o.json()).then(o=>{f.textContent=o.lowStockCount>0?o.lowStockCount:"",f.style.display=o.lowStockCount>0?"inline-block":"none",g.textContent=o.pendingOrders>0?o.pendingOrders:"",g.style.display=o.pendingOrders>0?"inline-block":"none",b.textContent=o.totalAlertas>0?o.totalAlertas:"",b.style.display=o.totalAlertas>0?"inline-block":"none"}).catch(o=>console.error("Error al actualizar badges:",o))};s(),setInterval(s,1e4)}});
