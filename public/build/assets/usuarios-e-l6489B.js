document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Usuarios cargado");const d=document.getElementById("search"),c=document.getElementById("usuarios-table-body"),s=document.querySelector(".pagination"),u="/usuarios",E=d==null?void 0:d.form;let b=null;d&&d.addEventListener("input",function(){clearTimeout(b),b=setTimeout(()=>{const t=d.value.trim();m(t)},300)}),E&&E.addEventListener("submit",function(t){t.preventDefault();const o=d.value.trim();m(o)}),s&&s.addEventListener("click",function(t){t.preventDefault();const o=t.target.closest(".page-link");if(o&&!o.parentElement.classList.contains("disabled")){const r=o.getAttribute("href");m(null,r)}});function m(t="",o=null){const r=o||`${u}?search=${encodeURIComponent(t)}`;fetch(r,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(e=>{if(!e.ok)throw new Error(`Error HTTP: ${e.status}`);return e.json()}).then(e=>{if(c.innerHTML="",e.data.length===0){c.innerHTML='<tr><td colspan="7" style="text-align:center;">No se encontraron usuarios</td></tr>';return}e.data.forEach(n=>{const a=document.createElement("tr"),f=document.createElement("td");f.textContent=n.id,a.appendChild(f);const h=document.createElement("td");h.textContent=n.name||"No disponible",a.appendChild(h);const C=document.createElement("td");C.textContent=n.email||"No disponible",a.appendChild(C);const y=document.createElement("td");y.textContent=n.phone||"No disponible",a.appendChild(y);const L=document.createElement("td");L.textContent=n.address||"No disponible",a.appendChild(L);const v=document.createElement("td");v.textContent=n.role||"Usuario",a.appendChild(v);const g=document.createElement("td");g.classList.add("action-cell"),g.innerHTML=`
                    <a href="/usuarios/${n.id}/edit" class="btn-editar" aria-label="Editar usuario ${n.name||"No disponible"}">Editar</a>
                    <button class="btn-eliminar" data-user-id="${n.id}" data-user-name="${n.name||"No disponible"}" aria-label="Eliminar usuario ${n.name||"No disponible"}">Eliminar</button>
                `,a.appendChild(g),c.appendChild(a)}),s.innerHTML=e.links||"";const i=t?`${u}?search=${encodeURIComponent(t)}`:u;window.history.pushState({},"",i)}).catch(e=>{console.error("Error fetching users:",e),c.innerHTML='<tr><td colspan="7" style="text-align:center;">Error al cargar usuarios</td></tr>'})}document.addEventListener("click",function(t){if(t.target.classList.contains("btn-eliminar")){t.preventDefault();const o=t.target.getAttribute("data-user-id"),r=t.target.getAttribute("data-user-name");console.log("Botón eliminar clickeado:",{userId:o,userName:r});let e=document.getElementById("delete-user-dialog");e||(e=document.createElement("dialog"),e.id="delete-user-dialog",document.body.appendChild(e),console.log("Diálogo creado")),e.innerHTML=`
                <div class="dialog-content">
                    <p id="mensaje-eliminar">¿Estás seguro de eliminar al usuario "${r}"?</p>
                    <div class="dialog-actions">
                        <button class="btn-dialog-si">Sí</button>
                        <button class="btn-dialog-no">No</button>
                    </div>
                </div>
            `;try{e.showModal(),console.log("Diálogo mostrado")}catch(i){console.error("Error al mostrar el diálogo:",i)}e.querySelector(".btn-dialog-si").addEventListener("click",function(){var n;console.log("Confirmado eliminación para usuario:",o);const i=document.createElement("form");i.action=`/usuarios/${o}`,i.method="POST",i.innerHTML=`
                    <input type="hidden" name="_token" value="${(n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.content}">
                    <input type="hidden" name="_method" value="DELETE">
                `,document.body.appendChild(i),i.submit(),e.close()}),e.querySelector(".btn-dialog-no").addEventListener("click",function(){console.log("Eliminación cancelada"),e.close()})}});const l=document.querySelector(".create-user-form"),p=l==null?void 0:l.querySelector(".btn-agregar");l&&p&&l.addEventListener("submit",function(){p.disabled=!0,p.textContent="Creando..."})});
