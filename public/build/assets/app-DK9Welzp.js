import{a as H}from"./index-DtQ_HIrt.js";window.axios=H;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Inventario cargado");const i=document.getElementById("btn-agregar"),o=document.getElementById("dialog-agregar"),d=document.getElementById("btn-cerrar");if(i&&o&&d){i.addEventListener("click",()=>o.showModal()),d.addEventListener("click",()=>o.close());const r=o.querySelector("form"),l=r==null?void 0:r.querySelector('button[type="submit"]');r==null||r.addEventListener("submit",()=>{l&&(l.disabled=!0,l.innerText="Creando...")})}const u=document.getElementById("dialog-editar"),E=document.getElementById("btn-cerrar-editar"),m=document.getElementById("form-editar");if(u&&m){document.querySelectorAll(".btn-editar-tabla").forEach(l=>{l.addEventListener("click",()=>{const t=l.dataset.id;document.getElementById("edit-nombre").value=l.dataset.nombre,document.getElementById("edit-tamaño").value=l.dataset.tamaño,document.getElementById("edit-precio").value=l.dataset.precio,document.getElementById("edit-stock").value=l.dataset.stock,m.action=`/productos/${t}`,u.showModal()})});const r=m.querySelector('button[type="submit"]');m.addEventListener("submit",()=>{r&&(r.disabled=!0,r.innerText="Editando...")}),E==null||E.addEventListener("click",()=>u.close())}const h=document.getElementById("dialog-eliminar"),C=document.getElementById("btn-cerrar-eliminar"),b=document.getElementById("btn-confirmar-eliminar");let c;h&&b&&(document.querySelectorAll(".btn-eliminar-tabla").forEach(r=>{r.addEventListener("click",()=>{c=r.dataset.id;const l=r.dataset.nombre||"producto",t=document.getElementById("mensaje-eliminar");t&&(t.innerText=`¿Estás seguro de que deseas eliminar el producto "${l}"?`),h.showModal()})}),b.addEventListener("click",()=>{var l;b.disabled=!0,b.innerText="Eliminando...";const r=(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content");fetch(`/productos/${c}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":r||"",Accept:"application/json"}}).then(t=>{t.ok?location.reload():(console.error("Error al eliminar:",t),alert("Error al eliminar el producto."))}).catch(t=>{console.error("Error:",t),alert("Hubo un problema al eliminar el producto: "+t.message)})}),C==null||C.addEventListener("click",()=>h.close()))});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Pedidos cargado");const i=document.getElementById("dialog-completar"),o=document.getElementById("dialog-cancelar"),d=document.getElementById("dialog-error"),u=document.getElementById("dialog-success");document.getElementById("detailsModal"),document.getElementById("mis-pedidos-details-modal");const E=document.getElementById("btn-cerrar-completar"),m=document.getElementById("btn-cerrar-cancelar"),h=document.getElementById("btn-cerrar-error"),C=document.getElementById("btn-cerrar-success"),b=document.getElementById("btn-confirmar-completar"),c=document.getElementById("btn-confirmar-cancelar"),r=document.getElementById("mensaje-error"),l=document.getElementById("mensaje-success"),t=document.getElementById("user_search"),v=document.getElementById("user_id"),a=document.getElementById("user-suggestions");let g,p;function L(e){r&&d&&(r.textContent=e,d.showModal())}function k(e){l&&u&&(l.textContent=e,u.showModal())}if(t&&a){let e=null;t.addEventListener("input",function(){clearTimeout(e),e=setTimeout(()=>{const s=t.value.trim();if(s.length<2){a.innerHTML="",a.style.display="none";return}fetch(`/usuarios?search=${encodeURIComponent(s)}`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(n=>{if(!n.ok)throw new Error(`Error HTTP: ${n.status}`);return n.json()}).then(n=>{if(a.innerHTML="",n.data.length===0){a.innerHTML='<div class="suggestion-item">No se encontraron usuarios</div>',a.style.display="block";return}n.data.forEach(f=>{const I=document.createElement("div");I.className="suggestion-item",I.textContent=`${f.name||"No disponible"} (${f.email})`,I.dataset.userId=f.id,I.addEventListener("click",()=>{t.value=`${f.name||"No disponible"} (${f.email})`,v.value=f.id,a.innerHTML="",a.style.display="none"}),a.appendChild(I)}),a.style.display="block"}).catch(n=>{console.error("Error fetching users:",n),a.innerHTML='<div class="suggestion-item">Error al buscar usuarios</div>',a.style.display="block"})},300)}),document.addEventListener("click",function(s){!t.contains(s.target)&&!a.contains(s.target)&&(a.innerHTML="",a.style.display="none")})}document.querySelectorAll(".btn-completar").forEach(e=>{e.addEventListener("click",function(s){s.preventDefault(),g=this.getAttribute("data-id"),p=this.closest("tr"),i&&i.showModal()})}),document.querySelectorAll(".btn-cancelar").forEach(e=>{e.addEventListener("click",function(s){s.preventDefault(),g=this.getAttribute("data-id"),p=this.closest("tr"),o&&o.showModal()})}),document.querySelectorAll(".btn-detalles, .mis-pedidos-btn-detalles").forEach(e=>{e.addEventListener("click",function(s){s.preventDefault();const n=this.getAttribute("data-id");n?D(n):L("ID del pedido no encontrado.")})});const S=document.querySelector(".btn-crear-pedido");S&&S.addEventListener("click",function(e){e.preventDefault(),window.location.href="/pedidos/create"}),document.querySelectorAll("#create-order-form, #edit-order-form").forEach(e=>{e.addEventListener("submit",function(s){var I;s.preventDefault();const n=e.querySelector('button[type="submit"]');if(n&&(n.disabled=!0,n.textContent=e.id==="create-order-form"?"Creando pedido...":"Guardando cambios..."),!v.value){L("Por favor, selecciona un usuario."),n&&(n.disabled=!1,n.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios");return}const f=Array.from(e.querySelectorAll(".item-quantity")).map((y,T)=>{const w=e.querySelectorAll(".item-product")[T],$=parseInt(w.selectedOptions[0].dataset.stock),A=parseInt(y.value);return A>$?(L(`La cantidad para ${w.selectedOptions[0].text} excede el stock disponible (${$}).`),null):{product_id:w.value,quantity:A}});if(f.includes(null)){n&&(n.disabled=!1,n.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios");return}fetch(e.action,{method:((I=e.querySelector('input[name="_method"]'))==null?void 0:I.value)||e.method,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({user_id:e.querySelector("#user_id").value,items:f})}).then(y=>y.ok?y.json():y.text().then(T=>{throw new Error(`Error HTTP: ${y.status} - ${T}`)})).then(y=>{y.success?(k(y.success),setTimeout(()=>window.location.href="/pedidos",1e3)):(L(y.error||"No se pudo procesar el pedido."),n&&(n.disabled=!1,n.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios"))}).catch(y=>{console.error("Error:",y),L("Hubo un problema: "+y.message),n&&(n.disabled=!1,n.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios")})})});const M=document.getElementById("add-item");M&&M.addEventListener("click",function(){const e=document.querySelector("#items-table tbody"),s=e.children.length,n=document.createElement("tr");n.innerHTML=`
                <td>
                    <select name="items[${s}][product_id]" class="item-product">
                        ${Array.from(document.querySelector(".item-product").options).map(f=>`<option value="${f.value}" data-stock="${f.dataset.stock}">${f.text}</option>`).join("")}
                    </select>
                </td>
                <td>
                    <input type="number" name="items[${s}][quantity]" value="1" min="1" class="item-quantity">
                </td>
                <td>
                    <button type="button" class="btn-remove-item">Eliminar</button>
                </td>
            `,e.appendChild(n)}),document.addEventListener("click",function(e){e.target.classList.contains("btn-remove-item")&&document.querySelectorAll("#items-table tbody tr").length>1&&e.target.closest("tr").remove()}),b&&b.addEventListener("click",function(){b.disabled=!0,b.textContent="Procesando...",fetch(`/pedidos/${g}/complete`,{method:"PATCH",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.ok?e.json():e.text().then(s=>{throw new Error(`Error HTTP: ${e.status} - ${s}`)})).then(e=>{if(e.success){const s=p==null?void 0:p.querySelector(".status-cell"),n=p==null?void 0:p.querySelector("td:last-child");s&&(s.textContent="Completado"),n&&(n.innerHTML=`<button class="btn-detalles" data-id="${g}" aria-label="Ver detalles del pedido #${g}">Ver Detalles</button>`),i&&i.close(),k(e.success)}else L(e.error||"No se pudo completar el pedido.")}).catch(e=>{console.error("Error:",e),L("Hubo un problema: "+e.message)}).finally(()=>{b&&(b.disabled=!1,b.textContent="Sí")})}),c&&c.addEventListener("click",function(){c.disabled=!0,c.textContent="Procesando...",fetch(`/pedidos/${g}/cancel`,{method:"PATCH",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.ok?e.json():e.text().then(s=>{throw new Error(`Error HTTP: ${e.status} - ${s}`)})).then(e=>{if(e.success){const s=p==null?void 0:p.querySelector(".status-cell"),n=p==null?void 0:p.querySelector("td:last-child");s&&(s.textContent="Cancelado"),n&&(n.innerHTML=`<button class="btn-detalles" data-id="${g}" aria-label="Ver detalles del pedido #${g}">Ver Detalles</button>`),o&&o.close(),k(e.success)}else L(e.error||"No se pudo cancelar el pedido.")}).catch(e=>{console.error("Error:",e),L("Hubo un problema al cancelar el pedido: "+e.message)}).finally(()=>{c&&(c.disabled=!1,c.textContent="Sí")})}),E&&i&&E.addEventListener("click",()=>i.close()),m&&o&&m.addEventListener("click",()=>o.close()),h&&d&&h.addEventListener("click",()=>d.close()),C&&u&&C.addEventListener("click",()=>u.close())});function D(i){fetch(`/pedidos/${i}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"text/html"}}).then(o=>{if(!o.ok)throw new Error("Error HTTP: "+o.status);return o.text()}).then(o=>{const d=document.getElementById("mis-pedidos-details-modal")||document.getElementById("detailsModal"),u=d.querySelector("#mis-pedidos-details-content")||document.getElementById("detailsContent"),E=d.querySelector("#mis-pedidos-pdf-link")||document.getElementById("pdfLink");u.innerHTML=o,E.href=`/pedidos/${i}/pdf`,d&&d.showModal()}).catch(o=>{console.error("Error al cargar detalles:",o);const d=document.getElementById("mensaje-error"),u=document.getElementById("dialog-error");d&&u&&(d.textContent="Error al cargar los detalles del pedido: "+o.message,u.showModal())})}document.addEventListener("DOMContentLoaded",function(){document.getElementById("search-registro").addEventListener("keypress",function(o){if(o.key==="Enter"){const d=o.target.value;window.location.href="/registro?search="+encodeURIComponent(d)}})});document.addEventListener("DOMContentLoaded",function(){const i=document.getElementById("ventasPorDiaChart").getContext("2d");new Chart(i,{type:"bar",data:{labels:window.chartLabels,datasets:[{label:"Productos Vendidos",data:window.chartData,backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},options:{scales:{y:{beginAtZero:!0,title:{display:!0,text:"Cantidad Vendida"}},x:{title:{display:!0,text:"Día del Mes"}}}}});const o=document.getElementById("productoMasVendidoChart").getContext("2d");new Chart(o,{type:"doughnut",data:{labels:[window.productoMasVendido?window.productoMasVendido.nombre:"Sin datos","Otros"],datasets:[{data:[window.productoMasVendido?window.productoMasVendido.total_vendido:0,1],backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(200, 200, 200, 0.3)"],borderColor:["rgba(255, 99, 132, 1)","rgba(200, 200, 200, 1)"],borderWidth:1}]},options:{plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(u){return u.label+": "+u.raw+" unidades"}}}}}});const d=document.getElementById("todosProductosChart").getContext("2d");new Chart(d,{type:"bar",data:{labels:window.productosLabels,datasets:[{label:"Cantidad Vendida",data:window.productosData,backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},options:{scales:{y:{beginAtZero:!0,title:{display:!0,text:"Cantidad Vendida"}},x:{title:{display:!0,text:"Producto"}}},plugins:{legend:{display:!1}}}})});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Ubicación cargado")});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Usuarios cargado");const i=document.getElementById("search"),o=document.getElementById("usuarios-table-body"),d=document.querySelector(".pagination"),u="/usuarios",E=i==null?void 0:i.form;let m=null;i&&i.addEventListener("input",function(){clearTimeout(m),m=setTimeout(()=>{const c=i.value.trim();h(c)},300)}),E&&E.addEventListener("submit",function(c){c.preventDefault();const r=i.value.trim();h(r)}),d&&d.addEventListener("click",function(c){c.preventDefault();const r=c.target.closest(".page-link");if(r&&!r.parentElement.classList.contains("disabled")){const l=r.getAttribute("href");h(null,l)}});function h(c="",r=null){const l=r||`${u}?search=${encodeURIComponent(c)}`;fetch(l,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(t=>{if(!t.ok)throw new Error(`Error HTTP: ${t.status}`);return t.json()}).then(t=>{if(o.innerHTML="",t.data.length===0){o.innerHTML='<tr><td colspan="7" style="text-align:center;">No se encontraron usuarios</td></tr>';return}t.data.forEach(a=>{const g=document.createElement("tr"),p=document.createElement("td");p.textContent=a.id,g.appendChild(p);const L=document.createElement("td");L.textContent=a.name||"No disponible",g.appendChild(L);const k=document.createElement("td");k.textContent=a.email||"No disponible",g.appendChild(k);const B=document.createElement("td");B.textContent=a.phone||"No disponible",g.appendChild(B);const q=document.createElement("td");q.textContent=a.address||"No disponible",g.appendChild(q);const x=document.createElement("td");x.textContent=a.role||"Usuario",g.appendChild(x);const S=document.createElement("td");S.classList.add("action-cell"),S.innerHTML=`
                    <a href="/usuarios/${a.id}/edit" class="btn-editar" aria-label="Editar usuario ${a.name||"No disponible"}">Editar</a>
                    <button class="btn-eliminar" data-user-id="${a.id}" data-user-name="${a.name||"No disponible"}" aria-label="Eliminar usuario ${a.name||"No disponible"}">Eliminar</button>
                `,g.appendChild(S),o.appendChild(g)}),d.innerHTML=t.links||"";const v=c?`${u}?search=${encodeURIComponent(c)}`:u;window.history.pushState({},"",v)}).catch(t=>{console.error("Error fetching users:",t),o.innerHTML='<tr><td colspan="7" style="text-align:center;">Error al cargar usuarios</td></tr>'})}document.addEventListener("click",function(c){if(c.target.classList.contains("btn-eliminar")){c.preventDefault();const r=c.target.getAttribute("data-user-id"),l=c.target.getAttribute("data-user-name");console.log("Botón eliminar clickeado:",{userId:r,userName:l});let t=document.getElementById("delete-user-dialog");t||(t=document.createElement("dialog"),t.id="delete-user-dialog",document.body.appendChild(t),console.log("Diálogo creado")),t.innerHTML=`
                <div class="dialog-content">
                    <p id="mensaje-eliminar">¿Estás seguro de eliminar al usuario "${l}"?</p>
                    <div class="dialog-actions">
                        <button class="btn-dialog-si">Sí</button>
                        <button class="btn-dialog-no">No</button>
                    </div>
                </div>
            `;try{t.showModal(),console.log("Diálogo mostrado")}catch(v){console.error("Error al mostrar el diálogo:",v)}t.querySelector(".btn-dialog-si").addEventListener("click",function(){var a;console.log("Confirmado eliminación para usuario:",r);const v=document.createElement("form");v.action=`/usuarios/${r}`,v.method="POST",v.innerHTML=`
                    <input type="hidden" name="_token" value="${(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content}">
                    <input type="hidden" name="_method" value="DELETE">
                `,document.body.appendChild(v),v.submit(),t.close()}),t.querySelector(".btn-dialog-no").addEventListener("click",function(){console.log("Eliminación cancelada"),t.close()})}});const C=document.querySelector(".create-user-form"),b=C==null?void 0:C.querySelector(".btn-agregar");C&&b&&C.addEventListener("submit",function(){b.disabled=!0,b.textContent="Creando..."})});document.addEventListener("DOMContentLoaded",()=>{const i=document.querySelector(".navbar-toggler")||document.querySelector("#navbar-toggler"),o=document.querySelector("#dashboard .dashboard-sidebar")||document.querySelector(".dashboard-sidebar"),d=document.getElementById("alertas-badge-hamburguesa");if(!i||!o||!d)return;const u=m=>{o.classList.toggle("active",m),document.body.classList.toggle("sidebar-open",m),d.style.display=m?"none":"inlineblock",localStorage.setItem("dashboardState",m?"visible":"hidden")},E=(localStorage.getItem("dashboardState")??"visible")!=="hidden";u(E),i.addEventListener("click",m=>{m.preventDefault();const h=o.classList.contains("active");d.style.display="inline-block",u(!h)})});
