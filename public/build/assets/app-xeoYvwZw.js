import{a as A}from"./index-DtQ_HIrt.js";window.axios=A;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Inventario cargado");const r=document.getElementById("btn-agregar"),n=document.getElementById("dialog-agregar"),d=document.getElementById("btn-cerrar");if(r&&n&&d){r.addEventListener("click",()=>n.showModal()),d.addEventListener("click",()=>n.close());const o=n.querySelector("form"),l=o==null?void 0:o.querySelector('button[type="submit"]');o==null||o.addEventListener("submit",()=>{l&&(l.disabled=!0,l.innerText="Creando...")})}const i=document.getElementById("dialog-editar"),C=document.getElementById("btn-cerrar-editar"),m=document.getElementById("form-editar");if(i&&m){document.querySelectorAll(".btn-editar-tabla").forEach(l=>{l.addEventListener("click",()=>{const c=l.dataset.id;document.getElementById("edit-nombre").value=l.dataset.nombre,document.getElementById("edit-tamaño").value=l.dataset.tamaño,document.getElementById("edit-precio").value=l.dataset.precio,document.getElementById("edit-stock").value=l.dataset.stock,m.action=`/productos/${c}`,i.showModal()})});const o=m.querySelector('button[type="submit"]');m.addEventListener("submit",()=>{o&&(o.disabled=!0,o.innerText="Editando...")}),C==null||C.addEventListener("click",()=>i.close())}const h=document.getElementById("dialog-eliminar"),p=document.getElementById("btn-cerrar-eliminar"),s=document.getElementById("btn-confirmar-eliminar");let b;h&&s&&(document.querySelectorAll(".btn-eliminar-tabla").forEach(o=>{o.addEventListener("click",()=>{b=o.dataset.id;const l=o.dataset.nombre||"producto",c=document.getElementById("mensaje-eliminar");c&&(c.innerText=`¿Estás seguro de que deseas eliminar el producto "${l}"?`),h.showModal()})}),s.addEventListener("click",()=>{var l;s.disabled=!0,s.innerText="Eliminando...";const o=(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content");fetch(`/productos/${b}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":o||"",Accept:"application/json"}}).then(c=>{c.ok?location.reload():(console.error("Error al eliminar:",c),alert("Error al eliminar el producto."))}).catch(c=>{console.error("Error:",c),alert("Hubo un problema al eliminar el producto: "+c.message)})}),p==null||p.addEventListener("click",()=>h.close()))});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Pedidos cargado");const r=document.getElementById("dialog-completar"),n=document.getElementById("dialog-cancelar"),d=document.getElementById("dialog-error"),i=document.getElementById("dialog-success");document.getElementById("detailsModal");const C=document.getElementById("btn-cerrar-completar"),m=document.getElementById("btn-cerrar-cancelar"),h=document.getElementById("btn-cerrar-error"),p=document.getElementById("btn-cerrar-success"),s=document.getElementById("btn-confirmar-completar"),b=document.getElementById("btn-confirmar-cancelar"),o=document.getElementById("mensaje-error"),l=document.getElementById("mensaje-success"),c=document.getElementById("user_search"),v=document.getElementById("user_id"),u=document.getElementById("user-suggestions");let L,g;function y(e){o&&d&&(o.textContent=e,d.showModal())}function k(e){l&&i&&(l.textContent=e,i.showModal())}if(c&&u){let e=null;c.addEventListener("input",function(){clearTimeout(e),e=setTimeout(()=>{const a=c.value.trim();if(a.length<2){u.innerHTML="",u.style.display="none";return}fetch(`/usuarios?search=${encodeURIComponent(a)}`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(t=>{if(!t.ok)throw new Error(`Error HTTP: ${t.status}`);return t.json()}).then(t=>{if(u.innerHTML="",t.data.length===0){u.innerHTML='<div class="suggestion-item">No se encontraron usuarios</div>',u.style.display="block";return}t.data.forEach(E=>{const I=document.createElement("div");I.className="suggestion-item",I.textContent=`${E.name||"No disponible"} (${E.email})`,I.dataset.userId=E.id,I.addEventListener("click",()=>{c.value=`${E.name||"No disponible"} (${E.email})`,v.value=E.id,u.innerHTML="",u.style.display="none"}),u.appendChild(I)}),u.style.display="block"}).catch(t=>{console.error("Error fetching users:",t),u.innerHTML='<div class="suggestion-item">Error al buscar usuarios</div>',u.style.display="block"})},300)}),document.addEventListener("click",function(a){!c.contains(a.target)&&!u.contains(a.target)&&(u.innerHTML="",u.style.display="none")})}document.querySelectorAll(".btn-completar").forEach(e=>{e.addEventListener("click",function(a){a.preventDefault(),L=this.getAttribute("data-id"),g=this.closest("tr"),r&&r.showModal()})}),document.querySelectorAll(".btn-cancelar").forEach(e=>{e.addEventListener("click",function(a){a.preventDefault(),L=this.getAttribute("data-id"),g=this.closest("tr"),n&&n.showModal()})}),document.querySelectorAll(".btn-detalles").forEach(e=>{e.addEventListener("click",function(a){a.preventDefault();const t=this.getAttribute("data-id");t?H(t):y("ID del pedido no encontrado.")})});const T=document.querySelector(".btn-crear-pedido");T&&T.addEventListener("click",function(e){e.preventDefault(),window.location.href="/pedidos/create"}),document.querySelectorAll("#create-order-form, #edit-order-form").forEach(e=>{e.addEventListener("submit",function(a){var I;a.preventDefault();const t=e.querySelector('button[type="submit"]');if(t&&(t.disabled=!0,t.textContent=e.id==="create-order-form"?"Creando pedido...":"Guardando cambios..."),!v.value){y("Por favor, selecciona un usuario."),t&&(t.disabled=!1,t.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios");return}const E=Array.from(e.querySelectorAll(".item-quantity")).map((f,x)=>{const w=e.querySelectorAll(".item-product")[x],M=parseInt(w.selectedOptions[0].dataset.stock),$=parseInt(f.value);return $>M?(y(`La cantidad para ${w.selectedOptions[0].text} excede el stock disponible (${M}).`),null):{product_id:w.value,quantity:$}});if(E.includes(null)){t&&(t.disabled=!1,t.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios");return}fetch(e.action,{method:((I=e.querySelector('input[name="_method"]'))==null?void 0:I.value)||e.method,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({user_id:e.querySelector("#user_id").value,items:E})}).then(f=>f.ok?f.json():f.text().then(x=>{throw new Error(`Error HTTP: ${f.status} - ${x}`)})).then(f=>{f.success?(k(f.success),setTimeout(()=>window.location.href="/pedidos",1e3)):(y(f.error||"No se pudo procesar el pedido."),t&&(t.disabled=!1,t.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios"))}).catch(f=>{console.error("Error:",f),y("Hubo un problema: "+f.message),t&&(t.disabled=!1,t.textContent=e.id==="create-order-form"?"Crear Pedido":"Guardar Cambios")})})});const q=document.getElementById("add-item");q&&q.addEventListener("click",function(){const e=document.querySelector("#items-table tbody"),a=e.children.length,t=document.createElement("tr");t.innerHTML=`
                <td>
                    <select name="items[${a}][product_id]" class="item-product">
                        ${Array.from(document.querySelector(".item-product").options).map(E=>`<option value="${E.value}" data-stock="${E.dataset.stock}">${E.text}</option>`).join("")}
                    </select>
                </td>
                <td>
                    <input type="number" name="items[${a}][quantity]" value="1" min="1" class="item-quantity">
                </td>
                <td>
                    <button type="button" class="btn-remove-item">Eliminar</button>
                </td>
            `,e.appendChild(t)}),document.addEventListener("click",function(e){e.target.classList.contains("btn-remove-item")&&document.querySelectorAll("#items-table tbody tr").length>1&&e.target.closest("tr").remove()}),s&&s.addEventListener("click",function(){s.disabled=!0,s.textContent="Procesando...",fetch(`/pedidos/${L}/complete`,{method:"PATCH",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.ok?e.json():e.text().then(a=>{throw new Error(`Error HTTP: ${e.status} - ${a}`)})).then(e=>{if(e.success){const a=g==null?void 0:g.querySelector(".status-cell"),t=g==null?void 0:g.querySelector("td:last-child");a&&(a.textContent="Completado"),t&&(t.innerHTML=`<button class="btn-detalles" data-id="${L}" aria-label="Ver detalles del pedido #${L}">Ver Detalles</button>`),r&&r.close(),k(e.success)}else y(e.error||"No se pudo completar el pedido.")}).catch(e=>{console.error("Error:",e),y("Hubo un problema: "+e.message)}).finally(()=>{s&&(s.disabled=!1,s.textContent="Sí")})}),b&&b.addEventListener("click",function(){b.disabled=!0,b.textContent="Procesando...",fetch(`/pedidos/${L}/cancel`,{method:"PATCH",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.ok?e.json():e.text().then(a=>{throw new Error(`Error HTTP: ${e.status} - ${a}`)})).then(e=>{if(e.success){const a=g==null?void 0:g.querySelector(".status-cell"),t=g==null?void 0:g.querySelector("td:last-child");a&&(a.textContent="Cancelado"),t&&(t.innerHTML=`<button class="btn-detalles" data-id="${L}" aria-label="Ver detalles del pedido #${L}">Ver Detalles</button>`),n&&n.close(),k(e.success)}else y(e.error||"No se pudo cancelar el pedido.")}).catch(e=>{console.error("Error:",e),y("Hubo un problema al cancelar el pedido: "+e.message)}).finally(()=>{b&&(b.disabled=!1,b.textContent="Sí")})}),C&&r&&C.addEventListener("click",()=>r.close()),m&&n&&m.addEventListener("click",()=>n.close()),h&&d&&h.addEventListener("click",()=>d.close()),p&&i&&p.addEventListener("click",()=>i.close())});function H(r){fetch(`/pedidos/${r}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"text/html"}}).then(n=>{if(!n.ok)throw new Error("Error HTTP: "+n.status);return n.text()}).then(n=>{document.getElementById("detailsContent").innerHTML=n,document.getElementById("pdfLink").href=`/pedidos/${r}/pdf`;const d=document.getElementById("detailsModal");d&&d.showModal()}).catch(n=>{console.error("Error al cargar detalles:",n);const d=document.getElementById("mensaje-error"),i=document.getElementById("dialog-error");d&&i&&(d.textContent="Error al cargar los detalles del pedido: "+n.message,i.showModal())})}document.addEventListener("DOMContentLoaded",function(){document.getElementById("search-registro").addEventListener("keypress",function(n){if(n.key==="Enter"){const d=n.target.value;window.location.href="/registro?search="+encodeURIComponent(d)}})});document.addEventListener("DOMContentLoaded",function(){const r=document.getElementById("ventasPorDiaChart").getContext("2d");new Chart(r,{type:"bar",data:{labels:window.chartLabels,datasets:[{label:"Productos Vendidos",data:window.chartData,backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},options:{scales:{y:{beginAtZero:!0,title:{display:!0,text:"Cantidad Vendida"}},x:{title:{display:!0,text:"Día del Mes"}}}}});const n=document.getElementById("productoMasVendidoChart").getContext("2d");new Chart(n,{type:"doughnut",data:{labels:[window.productoMasVendido?window.productoMasVendido.nombre:"Sin datos","Otros"],datasets:[{data:[window.productoMasVendido?window.productoMasVendido.total_vendido:0,1],backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(200, 200, 200, 0.3)"],borderColor:["rgba(255, 99, 132, 1)","rgba(200, 200, 200, 1)"],borderWidth:1}]},options:{plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(i){return i.label+": "+i.raw+" unidades"}}}}}});const d=document.getElementById("todosProductosChart").getContext("2d");new Chart(d,{type:"bar",data:{labels:window.productosLabels,datasets:[{label:"Cantidad Vendida",data:window.productosData,backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},options:{scales:{y:{beginAtZero:!0,title:{display:!0,text:"Cantidad Vendida"}},x:{title:{display:!0,text:"Producto"}}},plugins:{legend:{display:!1}}}})});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Ubicación cargado")});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Usuarios cargado");const r=document.getElementById("search"),n=document.getElementById("usuarios-table-body"),d=document.querySelector(".pagination"),i="/usuarios",C=r==null?void 0:r.form;let m=null;r&&r.addEventListener("input",function(){clearTimeout(m),m=setTimeout(()=>{const p=r.value.trim();h(p)},300)}),C&&C.addEventListener("submit",function(p){p.preventDefault();const s=r.value.trim();h(s)}),d&&d.addEventListener("click",function(p){p.preventDefault();const s=p.target.closest(".page-link");if(s&&!s.parentElement.classList.contains("disabled")){const b=s.getAttribute("href");h(null,b)}});function h(p="",s=null){const b=s||`${i}?search=${encodeURIComponent(p)}`;fetch(b,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(o=>{if(!o.ok)throw new Error(`Error HTTP: ${o.status}`);return o.json()}).then(o=>{if(n.innerHTML="",o.data.length===0){n.innerHTML='<tr><td colspan="6" style="text-align:center;">No se encontraron usuarios</td></tr>';return}o.data.forEach(c=>{const v=document.createElement("tr"),u=document.createElement("td");u.textContent=c.id,v.appendChild(u);const L=document.createElement("td");L.textContent=c.name||"No disponible",v.appendChild(L);const g=document.createElement("td");g.textContent=c.email||"No disponible",v.appendChild(g);const y=document.createElement("td");y.textContent=c.phone||"No disponible",v.appendChild(y);const k=document.createElement("td");k.textContent=c.address||"No disponible",v.appendChild(k);const S=document.createElement("td");S.textContent=c.role||"Usuario",v.appendChild(S);const B=document.createElement("td");B.innerHTML=`<a href="/usuarios/${c.id}/edit" class="btn-editar" aria-label="Editar usuario ${c.name||"No disponible"}">Editar</a>`,v.appendChild(B),n.appendChild(v)}),d.innerHTML=o.links||"";const l=p?`${i}?search=${encodeURIComponent(p)}`:i;window.history.pushState({},"",l)}).catch(o=>{console.error("Error fetching users:",o),n.innerHTML='<tr><td colspan="6" style="text-align:center;">Error al cargar usuarios</td></tr>'})}});document.addEventListener("DOMContentLoaded",()=>{const r=document.querySelector(".navbar-toggler")||document.querySelector("#navbar-toggler"),n=document.querySelector("#dashboard .dashboard-sidebar")||document.querySelector(".dashboard-sidebar"),d=document.getElementById("alertas-badge-hamburguesa");if(!r||!n||!d)return;const i=m=>{n.classList.toggle("active",m),document.body.classList.toggle("sidebar-open",m),d.style.display=m?"none":"inlineblock",localStorage.setItem("dashboardState",m?"visible":"hidden")},C=(localStorage.getItem("dashboardState")??"visible")!=="hidden";i(C),r.addEventListener("click",m=>{m.preventDefault();const h=n.classList.contains("active");d.style.display="inline-block",i(!h)})});
