import{a as M}from"./index-DtQ_HIrt.js";window.axios=M;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Inventario cargado");const r=document.getElementById("btn-agregar"),t=document.getElementById("dialog-agregar"),a=document.getElementById("btn-cerrar");if(r&&t&&a){r.addEventListener("click",()=>t.showModal()),a.addEventListener("click",()=>t.close());const n=t.querySelector("form"),i=n==null?void 0:n.querySelector('button[type="submit"]');n==null||n.addEventListener("submit",()=>{i&&(i.disabled=!0,i.innerText="Creando...")})}const s=document.getElementById("dialog-editar"),h=document.getElementById("btn-cerrar-editar"),f=document.getElementById("form-editar");if(s&&f){document.querySelectorAll(".btn-editar-tabla").forEach(i=>{i.addEventListener("click",()=>{const o=i.dataset.id;document.getElementById("edit-nombre").value=i.dataset.nombre,document.getElementById("edit-tamaño").value=i.dataset.tamaño,document.getElementById("edit-precio").value=i.dataset.precio,document.getElementById("edit-stock").value=i.dataset.stock,f.action=`/productos/${o}`,s.showModal()})});const n=f.querySelector('button[type="submit"]');f.addEventListener("submit",()=>{n&&(n.disabled=!0,n.innerText="Editando...")}),h==null||h.addEventListener("click",()=>s.close())}const b=document.getElementById("dialog-eliminar"),u=document.getElementById("btn-cerrar-eliminar"),c=document.getElementById("btn-confirmar-eliminar");let m;b&&c&&(document.querySelectorAll(".btn-eliminar-tabla").forEach(n=>{n.addEventListener("click",()=>{m=n.dataset.id;const i=n.dataset.nombre||"producto",o=document.getElementById("mensaje-eliminar");o&&(o.innerText=`¿Estás seguro de que deseas eliminar el producto "${i}"?`),b.showModal()})}),c.addEventListener("click",()=>{var i;c.disabled=!0,c.innerText="Eliminando...";const n=(i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content");fetch(`/productos/${m}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":n||"",Accept:"application/json"}}).then(o=>{o.ok?location.reload():(console.error("Error al eliminar:",o),alert("Error al eliminar el producto."))}).catch(o=>{console.error("Error:",o),alert("Hubo un problema al eliminar el producto: "+o.message)})}),u==null||u.addEventListener("click",()=>b.close()))});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Pedidos cargado");const r=document.getElementById("dialog-completar"),t=document.getElementById("dialog-cancelar"),a=document.getElementById("dialog-error"),s=document.getElementById("dialog-success");document.getElementById("detailsModal");const h=document.getElementById("btn-cerrar-completar"),f=document.getElementById("btn-cerrar-cancelar"),b=document.getElementById("btn-cerrar-error"),u=document.getElementById("btn-cerrar-success"),c=document.getElementById("btn-confirmar-completar"),m=document.getElementById("btn-confirmar-cancelar"),n=document.getElementById("mensaje-error"),i=document.getElementById("mensaje-success");let o,d;function g(e){n&&a&&(n.textContent=e,a.showModal())}function y(e){i&&s&&(i.textContent=e,s.showModal())}document.querySelectorAll(".btn-completar").forEach(e=>{e.addEventListener("click",function(l){l.preventDefault(),o=this.getAttribute("data-id"),d=this.closest("tr"),r&&r.showModal()})}),document.querySelectorAll(".btn-cancelar").forEach(e=>{e.addEventListener("click",function(l){l.preventDefault(),o=this.getAttribute("data-id"),d=this.closest("tr"),t&&t.showModal()})}),document.querySelectorAll(".btn-detalles").forEach(e=>{e.addEventListener("click",function(l){l.preventDefault();const p=this.getAttribute("data-id");p?$(p):g("ID del pedido no encontrado.")})});const v=document.querySelector(".btn-crear-pedido");v&&v.addEventListener("click",function(e){e.preventDefault(),window.location.href="/pedidos/create"}),document.querySelectorAll("#create-order-form, #edit-order-form").forEach(e=>{e.addEventListener("submit",function(l){var C,q;l.preventDefault();const p=Array.from(e.querySelectorAll(".item-quantity")).map((E,w)=>{const x=e.querySelectorAll(".item-product")[w],T=parseInt(x.selectedOptions[0].dataset.stock),A=parseInt(E.value);return A>T?(g(`La cantidad para ${x.selectedOptions[0].text} excede el stock disponible (${T}).`),null):{product_id:x.value,quantity:A}});p.includes(null)||fetch(e.action,{method:((C=e.querySelector('input[name="_method"]'))==null?void 0:C.value)||e.method,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({user_id:(q=e.querySelector("#user_id"))==null?void 0:q.value,items:p})}).then(E=>E.ok?E.json():E.text().then(w=>{throw new Error(`Error HTTP: ${E.status} - ${w}`)})).then(E=>{E.success?(y(E.success),setTimeout(()=>window.location.href="/pedidos",1e3)):g(E.error||"No se pudo procesar el pedido.")}).catch(E=>{console.error("Error:",E),g("Hubo un problema: "+E.message)})})});const S=document.getElementById("add-item");S&&S.addEventListener("click",function(){const e=document.querySelector("#items-table tbody"),l=e.children.length,p=document.createElement("tr");p.innerHTML=`
                <td>
                    <select name="items[${l}][product_id]" class="item-product">
                        ${Array.from(document.querySelector(".item-product").options).map(C=>`<option value="${C.value}" data-stock="${C.dataset.stock}">${C.text}</option>`).join("")}
                    </select>
                </td>
                <td>
                    <input type="number" name="items[${l}][quantity]" value="1" min="1" class="item-quantity">
                </td>
                <td>
                    <button type="button" class="btn-remove-item">Eliminar</button>
                </td>
            `,e.appendChild(p)}),document.addEventListener("click",function(e){e.target.classList.contains("btn-remove-item")&&document.querySelectorAll("#items-table tbody tr").length>1&&e.target.closest("tr").remove()}),c&&c.addEventListener("click",function(){c.disabled=!0,c.textContent="Procesando...",fetch(`/pedidos/${o}/complete`,{method:"PATCH",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.ok?e.json():e.text().then(l=>{throw new Error(`Error HTTP: ${e.status} - ${l}`)})).then(e=>{if(e.success){const l=d==null?void 0:d.querySelector(".status-cell"),p=d==null?void 0:d.querySelector("td:last-child");l&&(l.textContent="Completado"),p&&(p.innerHTML=`<button class="btn-detalles" data-id="${o}" aria-label="Ver detalles del pedido #${o}">Ver Detalles</button>`),r&&r.close(),y(e.success)}else g(e.error||"No se pudo completar el pedido.")}).catch(e=>{console.error("Error:",e),g("Hubo un problema: "+e.message)}).finally(()=>{c&&(c.disabled=!1,c.textContent="Sí")})}),m&&m.addEventListener("click",function(){m.disabled=!0,m.textContent="Procesando...",fetch(`/pedidos/${o}/cancel`,{method:"PATCH",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.ok?e.json():e.text().then(l=>{throw new Error(`Error HTTP: ${e.status} - ${l}`)})).then(e=>{if(e.success){const l=d==null?void 0:d.querySelector(".status-cell"),p=d==null?void 0:d.querySelector("td:last-child");l&&(l.textContent="Cancelado"),p&&(p.innerHTML=`<button class="btn-detalles" data-id="${o}" aria-label="Ver detalles del pedido #${o}">Ver Detalles</button>`),t&&t.close(),y(e.success)}else g(e.error||"No se pudo cancelar el pedido.")}).catch(e=>{console.error("Error:",e),g("Hubo un problema al cancelar el pedido: "+e.message)}).finally(()=>{m&&(m.disabled=!1,m.textContent="Sí")})}),h&&r&&h.addEventListener("click",()=>r.close()),f&&t&&f.addEventListener("click",()=>t.close()),b&&a&&b.addEventListener("click",()=>a.close()),u&&s&&u.addEventListener("click",()=>s.close())});function $(r){fetch(`/pedidos/${r}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"text/html"}}).then(t=>{if(!t.ok)throw new Error("Error HTTP: "+t.status);return t.text()}).then(t=>{document.getElementById("detailsContent").innerHTML=t,document.getElementById("pdfLink").href=`/pedidos/${r}/pdf`;const a=document.getElementById("detailsModal");a&&a.showModal()}).catch(t=>{console.error("Error al cargar detalles:",t);const a=document.getElementById("mensaje-error"),s=document.getElementById("dialog-error");a&&s&&(a.textContent="Error al cargar los detalles del pedido: "+t.message,s.showModal())})}document.addEventListener("DOMContentLoaded",function(){document.getElementById("search-registro").addEventListener("keypress",function(t){if(t.key==="Enter"){const a=t.target.value;window.location.href="/registro?search="+encodeURIComponent(a)}})});document.addEventListener("DOMContentLoaded",function(){const r=document.getElementById("ventasPorDiaChart").getContext("2d");new Chart(r,{type:"bar",data:{labels:window.chartLabels,datasets:[{label:"Productos Vendidos",data:window.chartData,backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},options:{scales:{y:{beginAtZero:!0,title:{display:!0,text:"Cantidad Vendida"}},x:{title:{display:!0,text:"Día del Mes"}}}}});const t=document.getElementById("productoMasVendidoChart").getContext("2d");new Chart(t,{type:"doughnut",data:{labels:[window.productoMasVendido?window.productoMasVendido.nombre:"Sin datos","Otros"],datasets:[{data:[window.productoMasVendido?window.productoMasVendido.total_vendido:0,1],backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(200, 200, 200, 0.3)"],borderColor:["rgba(255, 99, 132, 1)","rgba(200, 200, 200, 1)"],borderWidth:1}]},options:{plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(s){return s.label+": "+s.raw+" unidades"}}}}}});const a=document.getElementById("todosProductosChart").getContext("2d");new Chart(a,{type:"bar",data:{labels:window.productosLabels,datasets:[{label:"Cantidad Vendida",data:window.productosData,backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1}]},options:{scales:{y:{beginAtZero:!0,title:{display:!0,text:"Cantidad Vendida"}},x:{title:{display:!0,text:"Producto"}}},plugins:{legend:{display:!1}}}})});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Ubicación cargado")});document.addEventListener("DOMContentLoaded",function(){console.log("JavaScript de Usuarios cargado");const r=document.getElementById("search"),t=document.getElementById("usuarios-table-body"),a=document.querySelector(".pagination"),s="/usuarios",h=r==null?void 0:r.form;let f=null;r&&r.addEventListener("input",function(){clearTimeout(f),f=setTimeout(()=>{const u=r.value.trim();b(u)},300)}),h&&h.addEventListener("submit",function(u){u.preventDefault();const c=r.value.trim();b(c)}),a&&a.addEventListener("click",function(u){u.preventDefault();const c=u.target.closest(".page-link");if(c&&!c.parentElement.classList.contains("disabled")){const m=c.getAttribute("href");b(null,m)}});function b(u="",c=null){const m=c||`${s}?search=${encodeURIComponent(u)}`;fetch(m,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(n=>{if(!n.ok)throw new Error(`Error HTTP: ${n.status}`);return n.json()}).then(n=>{if(t.innerHTML="",n.data.length===0){t.innerHTML='<tr><td colspan="6" style="text-align:center;">No se encontraron usuarios</td></tr>';return}n.data.forEach(o=>{const d=document.createElement("tr"),g=document.createElement("td");g.textContent=o.id,d.appendChild(g);const y=document.createElement("td");y.textContent=o.name||"No disponible",d.appendChild(y);const L=document.createElement("td");L.textContent=o.email||"No disponible",d.appendChild(L);const I=document.createElement("td");I.textContent=o.phone||"No disponible",d.appendChild(I);const B=document.createElement("td");B.textContent=o.address||"No disponible",d.appendChild(B);const v=document.createElement("td");v.textContent=o.role||"Usuario",d.appendChild(v);const k=document.createElement("td");k.innerHTML=`<a href="/usuarios/${o.id}/edit" class="btn-editar" aria-label="Editar usuario ${o.name||"No disponible"}">Editar</a>`,d.appendChild(k),t.appendChild(d)}),a.innerHTML=n.links||"";const i=u?`${s}?search=${encodeURIComponent(u)}`:s;window.history.pushState({},"",i)}).catch(n=>{console.error("Error fetching users:",n),t.innerHTML='<tr><td colspan="6" style="text-align:center;">Error al cargar usuarios</td></tr>'})}});
